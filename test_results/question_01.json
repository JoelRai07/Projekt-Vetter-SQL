{
  "question": "Can you show me the top wealthy customers with their financial value? Including their IDs, total assets, total liabilities, the computed net worth value, and their ranking.",
  "ambiguity_check": {
    "is_ambiguous": true,
    "reason": "Wesentliche Parameter sind nicht festgelegt: Was bedeutet „top wealthy“ (nach networth, totassets, liqassets oder anderer Kennzahl) und wie viele Kunden sollen gezeigt werden. Außerdem ist „financial value“ unklar (meint es net worth, custlifeval/CLV, totassets oder etwas anderes). Für ein korrektes Ranking muss zudem definiert werden, wie mit negativen/NULL Net Worth umzugehen ist und ob es eine zeitliche Einschränkung (z.B. aktuelles scoredate) geben soll, da core_record mehrere Zeitpunkte enthalten kann.",
    "questions": [
      "Woran soll „top wealthy“ gemessen werden: nach Net Worth (networth bzw. totassets - totliabs) oder nach Total Assets (totassets) oder etwas anderem?",
      "Was genau meinst du mit „financial value“: Net Worth, Customer Lifetime Value (custlifeval/CLV) oder eine andere Kennzahl?",
      "Wie viele Kunden sollen ausgegeben werden (Top 10/50/100) und sollen Kunden mit negativem oder NULL Net Worth ausgeschlossen werden?",
      "Soll die Auswertung auf einen bestimmten Zeitraum/Stand begrenzt werden (z.B. neuestes scoredate/decidedate), falls es mehrere core_record-Einträge pro Kunde gibt?"
    ]
  },
  "generated_sql": "WITH ranked AS (\n  SELECT\n    cr.clientref AS customer_id,\n    ea.totassets AS total_assets,\n    ea.totliabs AS total_liabilities,\n    (ea.totassets - ea.totliabs) AS computed_net_worth,\n    RANK() OVER (ORDER BY (ea.totassets - ea.totliabs) DESC) AS wealth_rank\n  FROM core_record cr\n  JOIN employment_and_income ei\n    ON cr.coreregistry = ei.emplcoreref\n  JOIN expenses_and_assets ea\n    ON ei.emplcoreref = ea.expemplref\n)\nSELECT\n  customer_id,\n  total_assets,\n  total_liabilities,\n  computed_net_worth,\n  wealth_rank\nFROM ranked\nORDER BY wealth_rank\nLIMIT 10",
  "validation": {
    "is_valid": true,
    "errors": [],
    "severity": "low",
    "suggestions": [
      "Optional: Tie-breaker für deterministisches Ranking hinzufügen, z.B. RANK() OVER (ORDER BY (ea.totassets - ea.totliabs) DESC, cr.clientref) und/oder ORDER BY wealth_rank, customer_id im finalen SELECT.",
      "Optional: Wenn nur eindeutige Top-10 ohne Lücken gewünscht sind, DENSE_RANK() statt RANK() verwenden.",
      "Optional: Falls NULL-Werte in totassets/totliabs möglich sind, COALESCE(ea.totassets,0) und COALESCE(ea.totliabs,0) nutzen, um NULL-Net-Worth zu vermeiden."
    ]
  },
  "results": [
    {
      "customer_id": "CU154870",
      "total_assets": 1966126.0,
      "total_liabilities": 50822.0,
      "computed_net_worth": 1915304.0,
      "wealth_rank": 1
    },
    {
      "customer_id": "CU203973",
      "total_assets": 1951681.0,
      "total_liabilities": 51075.0,
      "computed_net_worth": 1900606.0,
      "wealth_rank": 2
    },
    {
      "customer_id": "CU452686",
      "total_assets": 1938937.0,
      "total_liabilities": 42258.0,
      "computed_net_worth": 1896679.0,
      "wealth_rank": 3
    },
    {
      "customer_id": "CU100984",
      "total_assets": 1983531.0,
      "total_liabilities": 130828.0,
      "computed_net_worth": 1852703.0,
      "wealth_rank": 4
    },
    {
      "customer_id": "CU503920",
      "total_assets": 1979348.0,
      "total_liabilities": 138403.0,
      "computed_net_worth": 1840945.0,
      "wealth_rank": 5
    },
    {
      "customer_id": "CU181502",
      "total_assets": 1967645.0,
      "total_liabilities": 151486.0,
      "computed_net_worth": 1816159.0,
      "wealth_rank": 6
    },
    {
      "customer_id": "CU209954",
      "total_assets": 1923802.0,
      "total_liabilities": 111285.0,
      "computed_net_worth": 1812517.0,
      "wealth_rank": 7
    },
    {
      "customer_id": "CU836390",
      "total_assets": 1924341.0,
      "total_liabilities": 128747.0,
      "computed_net_worth": 1795594.0,
      "wealth_rank": 8
    },
    {
      "customer_id": "CU369516",
      "total_assets": 1835689.0,
      "total_liabilities": 40900.0,
      "computed_net_worth": 1794789.0,
      "wealth_rank": 9
    },
    {
      "customer_id": "CU764644",
      "total_assets": 1816630.0,
      "total_liabilities": 32284.0,
      "computed_net_worth": 1784346.0,
      "wealth_rank": 10
    }
  ],
  "row_count": 10,
  "query_id": "e72c8c2dde684ba7b38b519992b0b883",
  "page": 1,
  "page_size": 50,
  "total_pages": 1,
  "total_rows": 10,
  "has_next_page": false,
  "has_previous_page": false,
  "notice": " Hinweis: Ambiguity: Wesentliche Parameter sind nicht festgelegt: Was bedeutet „top wealthy“ (nach networth, totassets, liqassets oder anderer Kennzahl) und wie viele Kunden sollen gezeigt werden. Außerdem ist „financial value“ unklar (meint es net worth, custlifeval/CLV, totassets oder etwas anderes). Für ein korrektes Ranking muss zudem definiert werden, wie mit negativen/NULL Net Worth umzugehen ist und ob es eine zeitliche Einschränkung (z.B. aktuelles scoredate) geben soll, da core_record mehrere Zeitpunkte enthalten kann.. Klärungsfragen: Woran soll „top wealthy“ gemessen werden: nach Net Worth (networth bzw. totassets - totliabs) oder nach Total Assets (totassets) oder etwas anderem?, Was genau meinst du mit „financial value“: Net Worth, Customer Lifetime Value (custlifeval/CLV) oder eine andere Kennzahl?, Wie viele Kunden sollen ausgegeben werden (Top 10/50/100) und sollen Kunden mit negativem oder NULL Net Worth ausgeschlossen werden?, Soll die Auswertung auf einen bestimmten Zeitraum/Stand begrenzt werden (z.B. neuestes scoredate/decidedate), falls es mehrere core_record-Einträge pro Kunde gibt?",
  "summary": "Die Abfrage liefert die Top-10 vermögendsten Kunden nach berechnetem Nettovermögen (Total Assets minus Total Liabilities) inklusive Ranking. Auf Platz 1 liegt CU154870 mit 1,966,126 Gesamtvermögen und 50,822 Verbindlichkeiten (Net Worth 1,915,304), gefolgt von CU203973 (Net Worth 1,900,606) und CU452686 (Net Worth 1,896,679). Insgesamt liegen die führenden Nettovermögen eng beieinander (rund 1,90–1,92 Mio.), wobei die Verbindlichkeiten im Vergleich zu den Assets relativ gering ausfallen.",
  "explanation": "Lists the top 10 wealthiest customers by computed net worth (total_assets - total_liabilities). Outputs CU-format customer_id, assets, liabilities, computed net worth, and a rank based on net worth (1 = highest).",
  "error": null
}