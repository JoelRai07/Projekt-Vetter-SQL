{
  "question": "Can you show me the top wealthy customers with their financial value? Including their IDs, total assets, total liabilities, the computed net worth value, and their ranking.",
  "ambiguity_check": {
    "is_ambiguous": true,
    "reason": "Wesentliche Parameter für eine korrekte SQL-Abfrage fehlen: Was genau bedeutet „top wealthy“ (Ranking nach networth oder totassets?), wie viele Kunden sollen gezeigt werden (Top N), und ob negative Net Worth ausgeschlossen werden soll. Außerdem ist „their IDs“ unklar (clientref vs. coreregistry vs. appref), und „financial value“ kann mehrere Kennzahlen meinen (networth, totassets, custlifeval).",
    "questions": [
      "Wie definieren Sie „top wealthy“: nach berechnetem Net Worth (networth bzw. totassets - totliabs) oder nach Total Assets (totassets)?",
      "Wie viele Datensätze sollen ausgegeben werden (Top 10, Top 100, etc.) und sollen Kunden mit negativem Net Worth ausgeschlossen werden?",
      "Welche ID soll angezeigt werden: coreregistry (Kernschlüssel), clientref (Kunden-ID) oder appref (Antrags-ID)?",
      "Was meinen Sie mit „financial value“: Net Worth, Total Assets, oder Customer Lifetime Value (custlifeval)?"
    ]
  },
  "generated_sql": "WITH base AS (\n  SELECT\n    cr.clientref AS customer_id,\n    ea.totassets AS total_assets,\n    ea.totliabs AS total_liabilities,\n    (ea.totassets - ea.totliabs) AS computed_net_worth\n  FROM core_record cr\n  JOIN employment_and_income ei ON cr.coreregistry = ei.emplcoreref\n  JOIN expenses_and_assets ea ON ei.emplcoreref = ea.expemplref\n  WHERE ea.totassets IS NOT NULL\n    AND ea.totliabs IS NOT NULL\n)\nSELECT\n  customer_id,\n  total_assets,\n  total_liabilities,\n  computed_net_worth,\n  DENSE_RANK() OVER (ORDER BY computed_net_worth DESC) AS wealth_rank\nFROM base\nORDER BY computed_net_worth DESC\nLIMIT 10",
  "validation": {
    "is_valid": true,
    "errors": [],
    "severity": "low",
    "suggestions": [
      "Optional: Add a deterministic tie-breaker to the window ORDER BY (e.g., ORDER BY computed_net_worth DESC, customer_id) to make ranking stable when net worth ties occur.",
      "Optional: If you want to exclude negative net worth, add a filter like WHERE (ea.totassets - ea.totliabs) >= 0 in the CTE."
    ]
  },
  "results": [
    {
      "customer_id": "CU154870",
      "total_assets": 1966126.0,
      "total_liabilities": 50822.0,
      "computed_net_worth": 1915304.0,
      "wealth_rank": 1
    },
    {
      "customer_id": "CU203973",
      "total_assets": 1951681.0,
      "total_liabilities": 51075.0,
      "computed_net_worth": 1900606.0,
      "wealth_rank": 2
    },
    {
      "customer_id": "CU452686",
      "total_assets": 1938937.0,
      "total_liabilities": 42258.0,
      "computed_net_worth": 1896679.0,
      "wealth_rank": 3
    },
    {
      "customer_id": "CU100984",
      "total_assets": 1983531.0,
      "total_liabilities": 130828.0,
      "computed_net_worth": 1852703.0,
      "wealth_rank": 4
    },
    {
      "customer_id": "CU503920",
      "total_assets": 1979348.0,
      "total_liabilities": 138403.0,
      "computed_net_worth": 1840945.0,
      "wealth_rank": 5
    },
    {
      "customer_id": "CU181502",
      "total_assets": 1967645.0,
      "total_liabilities": 151486.0,
      "computed_net_worth": 1816159.0,
      "wealth_rank": 6
    },
    {
      "customer_id": "CU209954",
      "total_assets": 1923802.0,
      "total_liabilities": 111285.0,
      "computed_net_worth": 1812517.0,
      "wealth_rank": 7
    },
    {
      "customer_id": "CU836390",
      "total_assets": 1924341.0,
      "total_liabilities": 128747.0,
      "computed_net_worth": 1795594.0,
      "wealth_rank": 8
    },
    {
      "customer_id": "CU369516",
      "total_assets": 1835689.0,
      "total_liabilities": 40900.0,
      "computed_net_worth": 1794789.0,
      "wealth_rank": 9
    },
    {
      "customer_id": "CU764644",
      "total_assets": 1816630.0,
      "total_liabilities": 32284.0,
      "computed_net_worth": 1784346.0,
      "wealth_rank": 10
    }
  ],
  "row_count": 10,
  "query_id": "0b113cde3f0948bbb673d4f279581815",
  "page": 1,
  "page_size": 50,
  "total_pages": 1,
  "total_rows": 10,
  "has_next_page": false,
  "has_previous_page": false,
  "notice": " Hinweis: Ambiguity: Wesentliche Parameter für eine korrekte SQL-Abfrage fehlen: Was genau bedeutet „top wealthy“ (Ranking nach networth oder totassets?), wie viele Kunden sollen gezeigt werden (Top N), und ob negative Net Worth ausgeschlossen werden soll. Außerdem ist „their IDs“ unklar (clientref vs. coreregistry vs. appref), und „financial value“ kann mehrere Kennzahlen meinen (networth, totassets, custlifeval).. Klärungsfragen: Wie definieren Sie „top wealthy“: nach berechnetem Net Worth (networth bzw. totassets - totliabs) oder nach Total Assets (totassets)?, Wie viele Datensätze sollen ausgegeben werden (Top 10, Top 100, etc.) und sollen Kunden mit negativem Net Worth ausgeschlossen werden?, Welche ID soll angezeigt werden: coreregistry (Kernschlüssel), clientref (Kunden-ID) oder appref (Antrags-ID)?, Was meinen Sie mit „financial value“: Net Worth, Total Assets, oder Customer Lifetime Value (custlifeval)?",
  "summary": "Die Abfrage zeigt die Top-10 vermögendsten Kunden basierend auf dem berechneten Nettovermögen (Total Assets minus Total Liabilities) inklusive Ranking. Auf Platz 1 liegt CU154870 mit 1,966,126 Gesamtvermögen und 50,822 Verbindlichkeiten (Nettovermögen 1,915,304), gefolgt von CU203973 (Nettovermögen 1,900,606) und CU452686 (Nettovermögen 1,896,679). Insgesamt liegen die Top-3 sehr nah beieinander, mit Nettovermögen jeweils knapp unter bzw. über 1,9 Mio.",
  "explanation": "Returns the top 10 customers by computed net worth (total_assets - total_liabilities), showing CU-format customer_id, assets, liabilities, computed net worth, and a rank (1 = highest net worth).",
  "error": null
}