{
  "question": "To analyze customer property leverage, please show the customer ID, property value, mortgage balance, and the calculated ratio.",
  "ambiguity_check": {
    "is_ambiguous": false,
    "reason": "Die Anfrage ist ausreichend klar: Benötigt werden Kunden-ID (core_record.clientref), Immobilienwert und Hypothekenstand aus expenses_and_assets.propfinancialdata (JSON-Felder propvalue und mortgagebits.mortbalance) sowie deren Verhältnis (LTV = mortbalance/propvalue). Es ist kein Zeitraum, keine Aggregation und kein Schwellenwert erforderlich, um eine korrekte Abfrage zu formulieren.",
    "questions": []
  },
  "generated_sql": "SELECT\n  cr.coreregistry AS customer_id,\n  CAST(json_extract(ea.propfinancialdata, '$.propvalue') AS REAL) AS property_value,\n  CAST(json_extract(ea.propfinancialdata, '$.mortgagebits.mortbalance') AS REAL) AS mortgage_balance,\n  CAST(json_extract(ea.propfinancialdata, '$.mortgagebits.mortbalance') AS REAL)\n    / CAST(json_extract(ea.propfinancialdata, '$.propvalue') AS REAL) AS property_leverage_ratio\nFROM core_record cr\nJOIN employment_and_income ei ON cr.coreregistry = ei.emplcoreref\nJOIN expenses_and_assets ea ON ei.emplcoreref = ea.expemplref\nJOIN bank_and_transactions bt ON ea.expemplref = bt.bankexpref\nJOIN credit_and_compliance cc ON bt.bankexpref = cc.compbankref\nJOIN credit_accounts_and_history cah ON cc.compbankref = cah.histcompref\nWHERE CAST(json_extract(ea.propfinancialdata, '$.propvalue') AS REAL) IS NOT NULL\n  AND CAST(json_extract(ea.propfinancialdata, '$.propvalue') AS REAL) <> 0\n  AND CAST(json_extract(ea.propfinancialdata, '$.mortgagebits.mortbalance') AS REAL) IS NOT NULL\nORDER BY property_leverage_ratio DESC",
  "validation": {
    "is_valid": true,
    "errors": [],
    "severity": "low",
    "suggestions": [
      "Division-by-zero-Schutz ist vorhanden (propvalue <> 0). Optional zusätzlich: AND CAST(json_extract(ea.propfinancialdata, '$.mortgagebits.mortbalance') AS REAL) >= 0, falls negative Werte ausgeschlossen werden sollen.",
      "Zur Performance/Lesbarkeit: json_extract nur einmal berechnen (z.B. per CTE/Subquery) und dann property_value/mortgage_balance wiederverwenden, statt mehrfach zu casten.",
      "Optional: Wenn nur Datensätze mit vorhandenen Immobilien-/Hypothekenfeldern gewünscht sind, zusätzlich prüfen, dass json_type(ea.propfinancialdata, '$.mortgagebits') IS NOT NULL."
    ]
  },
  "results": [
    {
      "customer_id": "CS108475",
      "property_value": 1018.0,
      "mortgage_balance": 1276018.0,
      "property_leverage_ratio": 1253.4557956777996
    },
    {
      "customer_id": "CS232079",
      "property_value": 389.0,
      "mortgage_balance": 433348.0,
      "property_leverage_ratio": 1114.0051413881747
    },
    {
      "customer_id": "CS138931",
      "property_value": 3029.0,
      "mortgage_balance": 560342.0,
      "property_leverage_ratio": 184.992406734896
    },
    {
      "customer_id": "CS977546",
      "property_value": 2911.0,
      "mortgage_balance": 402921.0,
      "property_leverage_ratio": 138.41326004809343
    },
    {
      "customer_id": "CS391718",
      "property_value": 15854.0,
      "mortgage_balance": 1380340.0,
      "property_leverage_ratio": 87.06572473823641
    },
    {
      "customer_id": "CS688942",
      "property_value": 11771.0,
      "mortgage_balance": 840171.0,
      "property_leverage_ratio": 71.37634865347039
    },
    {
      "customer_id": "CS535463",
      "property_value": 16928.0,
      "mortgage_balance": 969991.0,
      "property_leverage_ratio": 57.300980623818525
    },
    {
      "customer_id": "CS834551",
      "property_value": 25667.0,
      "mortgage_balance": 1405642.0,
      "property_leverage_ratio": 54.76456149920131
    },
    {
      "customer_id": "CS255224",
      "property_value": 13055.0,
      "mortgage_balance": 506328.0,
      "property_leverage_ratio": 38.784220605132134
    },
    {
      "customer_id": "CS118800",
      "property_value": 36820.0,
      "mortgage_balance": 1359382.0,
      "property_leverage_ratio": 36.91966322650733
    },
    {
      "customer_id": "CS299524",
      "property_value": 26621.0,
      "mortgage_balance": 866219.0,
      "property_leverage_ratio": 32.5389354269186
    },
    {
      "customer_id": "CS456305",
      "property_value": 35937.0,
      "mortgage_balance": 1137642.0,
      "property_leverage_ratio": 31.656565656565657
    },
    {
      "customer_id": "CS873731",
      "property_value": 48533.0,
      "mortgage_balance": 1477880.0,
      "property_leverage_ratio": 30.45103331753652
    },
    {
      "customer_id": "CS507190",
      "property_value": 41709.0,
      "mortgage_balance": 1246377.0,
      "property_leverage_ratio": 29.882687189815147
    },
    {
      "customer_id": "CS964207",
      "property_value": 48706.0,
      "mortgage_balance": 1446260.0,
      "property_leverage_ratio": 29.69367223750667
    },
    {
      "customer_id": "CS189697",
      "property_value": 42738.0,
      "mortgage_balance": 1268554.0,
      "property_leverage_ratio": 29.682109598015817
    },
    {
      "customer_id": "CS760966",
      "property_value": 53826.0,
      "mortgage_balance": 1363693.0,
      "property_leverage_ratio": 25.335209749934975
    },
    {
      "customer_id": "CS834384",
      "property_value": 9232.0,
      "mortgage_balance": 209007.0,
      "property_leverage_ratio": 22.639406412478337
    },
    {
      "customer_id": "CS378996",
      "property_value": 60617.0,
      "mortgage_balance": 1286710.0,
      "property_leverage_ratio": 21.226883547519673
    },
    {
      "customer_id": "CS797734",
      "property_value": 74699.0,
      "mortgage_balance": 1438525.0,
      "property_leverage_ratio": 19.25762058394356
    },
    {
      "customer_id": "CS620062",
      "property_value": 73658.0,
      "mortgage_balance": 1326515.0,
      "property_leverage_ratio": 18.009109669010833
    },
    {
      "customer_id": "CS399140",
      "property_value": 39039.0,
      "mortgage_balance": 688896.0,
      "property_leverage_ratio": 17.646353646353646
    },
    {
      "customer_id": "CS429393",
      "property_value": 66103.0,
      "mortgage_balance": 1164642.0,
      "property_leverage_ratio": 17.618595222607144
    },
    {
      "customer_id": "CS367960",
      "property_value": 35025.0,
      "mortgage_balance": 571052.0,
      "property_leverage_ratio": 16.30412562455389
    },
    {
      "customer_id": "CS657281",
      "property_value": 43860.0,
      "mortgage_balance": 712501.0,
      "property_leverage_ratio": 16.244892840857272
    },
    {
      "customer_id": "CS289722",
      "property_value": 39256.0,
      "mortgage_balance": 619529.0,
      "property_leverage_ratio": 15.781765844711636
    },
    {
      "customer_id": "CS171476",
      "property_value": 36360.0,
      "mortgage_balance": 555735.0,
      "property_leverage_ratio": 15.284240924092408
    },
    {
      "customer_id": "CS106874",
      "property_value": 71638.0,
      "mortgage_balance": 918529.0,
      "property_leverage_ratio": 12.821812445908597
    },
    {
      "customer_id": "CS471468",
      "property_value": 79086.0,
      "mortgage_balance": 993049.0,
      "property_leverage_ratio": 12.556571327415725
    },
    {
      "customer_id": "CS109017",
      "property_value": 73521.0,
      "mortgage_balance": 847585.0,
      "property_leverage_ratio": 11.528474857523701
    },
    {
      "customer_id": "CS411845",
      "property_value": 51849.0,
      "mortgage_balance": 546601.0,
      "property_leverage_ratio": 10.542170533665066
    },
    {
      "customer_id": "CS392396",
      "property_value": 114903.0,
      "mortgage_balance": 1165029.0,
      "property_leverage_ratio": 10.1392391843555
    },
    {
      "customer_id": "CS626118",
      "property_value": 70650.0,
      "mortgage_balance": 713405.0,
      "property_leverage_ratio": 10.097735314932768
    },
    {
      "customer_id": "CS674943",
      "property_value": 126169.0,
      "mortgage_balance": 1255430.0,
      "property_leverage_ratio": 9.950384008750168
    },
    {
      "customer_id": "CS340974",
      "property_value": 72890.0,
      "mortgage_balance": 716833.0,
      "property_leverage_ratio": 9.834449169982165
    },
    {
      "customer_id": "CS275485",
      "property_value": 150704.0,
      "mortgage_balance": 1423908.0,
      "property_leverage_ratio": 9.44837562373925
    },
    {
      "customer_id": "CS795226",
      "property_value": 137821.0,
      "mortgage_balance": 1164761.0,
      "property_leverage_ratio": 8.451259242060354
    },
    {
      "customer_id": "CS831931",
      "property_value": 148657.0,
      "mortgage_balance": 1237078.0,
      "property_leverage_ratio": 8.321693563034367
    },
    {
      "customer_id": "CS727563",
      "property_value": 44509.0,
      "mortgage_balance": 364223.0,
      "property_leverage_ratio": 8.18313150149408
    },
    {
      "customer_id": "CS637923",
      "property_value": 161949.0,
      "mortgage_balance": 1308215.0,
      "property_leverage_ratio": 8.07794429110399
    },
    {
      "customer_id": "CS343253",
      "property_value": 41249.0,
      "mortgage_balance": 332742.0,
      "property_leverage_ratio": 8.066668282867463
    },
    {
      "customer_id": "CS580015",
      "property_value": 74603.0,
      "mortgage_balance": 569334.0,
      "property_leverage_ratio": 7.631516158867606
    },
    {
      "customer_id": "CS438769",
      "property_value": 85919.0,
      "mortgage_balance": 638404.0,
      "property_leverage_ratio": 7.430300631990596
    },
    {
      "customer_id": "CS971966",
      "property_value": 108235.0,
      "mortgage_balance": 802970.0,
      "property_leverage_ratio": 7.418764724904144
    },
    {
      "customer_id": "CS228336",
      "property_value": 161865.0,
      "mortgage_balance": 1192259.0,
      "property_leverage_ratio": 7.365761591449665
    },
    {
      "customer_id": "CS616098",
      "property_value": 144526.0,
      "mortgage_balance": 1034036.0,
      "property_leverage_ratio": 7.15467113183787
    },
    {
      "customer_id": "CS143502",
      "property_value": 188903.0,
      "mortgage_balance": 1285410.0,
      "property_leverage_ratio": 6.80460342080327
    },
    {
      "customer_id": "CS532792",
      "property_value": 117243.0,
      "mortgage_balance": 790094.0,
      "property_leverage_ratio": 6.738943902834285
    },
    {
      "customer_id": "CS155730",
      "property_value": 222358.0,
      "mortgage_balance": 1497868.0,
      "property_leverage_ratio": 6.736290126732566
    },
    {
      "customer_id": "CS431093",
      "property_value": 18975.0,
      "mortgage_balance": 126135.0,
      "property_leverage_ratio": 6.647430830039526
    }
  ],
  "row_count": 50,
  "query_id": "b338dbe77f194bfd989c275e40b7c750",
  "page": 1,
  "page_size": 50,
  "total_pages": 20,
  "total_rows": 1000,
  "has_next_page": true,
  "has_previous_page": false,
  "notice": "Seite 1 von 20 (50 von 1000 Zeilen). Weitere Seiten verfügbar. ",
  "summary": "Die Abfrage liefert 1.000 Kunden mit vorhandenen Immobilienwerten und Hypothekensalden und sortiert sie nach dem höchsten Beleihungsgrad (mortgage_balance/property_value). In den Top-Ergebnissen fallen extrem hohe Leverage-Ratios auf: CS108475 hat bei einem property_value von 1.018 und mortgage_balance von 1.276.018 ein Ratio von ca. 1.253,46, gefolgt von CS232079 (389 vs. 433.348; ca. 1.114,01); CS138931 liegt deutlich darunter (3.029 vs. 560.342; ca. 184,99). Diese Ausreißer deuten auf sehr niedrige erfasste Immobilienwerte oder potenzielle Datenqualitätsprobleme hin und sollten für Plausibilitätschecks priorisiert werden.",
  "explanation": "Returns one row per customer with property data, extracting property value and mortgage balance from expenses_and_assets.propfinancialdata, computing leverage as mortgage_balance/property_value, excluding missing or zero property values (and missing mortgage balances), and ranking customers by highest leverage ratio first. [BSL compliance regeneration]",
  "error": null
}